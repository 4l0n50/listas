
In this section we construct a QA-NIZK argument that many commitments open to elements in a set $[0,d-1] \subset \Z_q$ or  $S \subset \GG_{\gamma}$. With the purpose of expressing the problem in a unified way, 
we define a broader class of languages which comprises both these languages as a special case. 


\begin{definition}
Denote by $\Lang_{[\matr{M}]_1,[\matr{N}]_1,\matr{\Lambda},\grkb{\alpha}}\subseteq\GG_1^\la$ the language parameterized by $[\matr{M}]_1 \in\GG_1^{\la\times \lb},\matr{N}\in\GG_1^{\la\times \lc},\matr{\Lambda}\in\Z_q^{\ld\times\lb},$ and $\grkb{\alpha}\in\Z_q^\ld$ such that
\begin{equation}\label{eq:definition1}
[\vecb{x}]_1\in\Lang_{[\matr{M}]_1,[\matr{N}]_1,\matr{\Lambda},\grkb{\alpha}} \Longleftrightarrow \exists \vecb{b}\in\bits^\lb,\vecb{w}\in\Z_q^\lc \text{ s.t. }
\pmatri
{
    \vecb{x}\\
    \grkb{\alpha}
}
=
\begin{pmatrix}
    \matr{M}       & \matr{N}\\
    \matr{\Lambda} & \matr{0}_{\ld\times \lc}
\end{pmatrix}
\pmatri
{
    \vecb{b}\\
    \vecb{w}
}.
\end{equation}
Additionally, we require $(\matr{N},[\matr{N}]_1)$ to be efficiently samplable and that membership in $\Lang_{[\matr{M}]_1,[\matr{N}]_1,\matr{\Lambda},\grkb{\alpha}}$ is efficiently testable with the trapdoor $\matr{N}$, that is, that there exists an efficient algorithm $\algF$ such that $\algF([\matr{M}]_1,\matr{N},[\vecb{x}]_1)=1\Longleftrightarrow [\vecb{x}]_1\in\Lang_{\matr{M},\matr{N},\matr{\Lambda},\grkb{\alpha}}.$ The witness of 
$[\vecb{x}]_1\in\Lang_{[\matr{M}]_1,[\matr{N}]_1,\matr{\Lambda},\grkb{\alpha}}$ is $(\vecb{b},\vecb{w})$, and the bit-witness is $\vecb{b}$. The size of the bit-witness is $\lb$. 
\end{definition}

These languages easily express languages of set membership as shown below.


\begin{example}
The language of GS commitments to group elements in the set $S:=\{[s_1]_1,\ldots,[s_\lb]_1\}$, $\Lang_{ck,S}$, where $ck:=([\vecb{u}_1]_1||[\vecb{u}_2]_1)$, is equal to $\Lang_{[\matr{M}]_1,[\matr{N}]_1,\matr{\Lambda},\grkb{\alpha}}$, where
$\matr{M}:=\smallpmatrix{s_1 & \cdots & s_\lb \\ 0 &\cdots & 0}$, $\matr{N}:=(\vecb{u}_1-\vecb{e}_1||\vecb{u}_2)$, $\alpha=1$, and $\matr{\Lambda}=(1,\ldots,1)$. The bit-witness size is $|S|$ and membership $\Lang_{ck,S}$ is efficiently testable given $\vecb{u}_1,\vecb{u}_2$ and whenever $|S|=\poly(\lambda)$. 
\end{example}

Although in the previous example $S$ could be an integer interval $[0,d-1]$, this case allows a smaller witness size.

\begin{example}
The language of GS commitments to integers in the range $[0,d-1]$, $\Lang_{ck,[0,d-1]}$, where $ck:=([\vecb{u}_1]_1||[\vecb{u}_2]_1)$, is equal to $\Lang_{[\matr{M}]_1,[\matr{N}]_1,\matr{\Lambda},\grkb{\alpha}}$, where
$\matr{M}:=\vecb{u}_1(2^0,2^1,\ldots,2^{\log d-1})\in\Z_q^{2\times \log d}$, $\matr{N}:=\vecb{u}_2\in\Z_q^{2}$, and $\ld:=0$. The bit-witness size is $\log d$ and membership in $\Lang_{ck,[0,d-1]}$ is easily testable given $\vecb{u}_2$ and whenever $d=\poly(\lambda)$. 
\end{example}

In both examples, one may think of $[\vecb{x}]_1$ as a commitment to $\vecb{b}$ using commitment key $ck:=([\matr{M}]_1||[\matr{N}]_1)$. Although in general this may be false, if one thinks in this way is easy to construct a proof of size $\Theta(\lb)$ for this language,  which roughly follows these steps:
\begin{enumerate}
\item Construct a GS commitment $[\vecb{c}_j]_1$ to $b_j$, for all $j \in [\lb]$.
\item Prove that $b_j \in \{0,1\}$, for all $j \in [\lb]$.
\item Prove that $[\vecb{c}]_1:=[\vecb{c}_1]_1 \oplus \ldots \oplus [\vecb{c}_n]_1$ and $[\vecb{x}]_1$ open to the same value.
\item Prove that $\pmatri
{
    [\vecb{x}]_1\\
    [\grkb{\alpha}]_1
}$ is in the image of the matrix $
\begin{pmatrix}
    [\matr{M}]_1       & [\matr{N}]_1\\
    [\matr{\Lambda}]_1 & [\matr{0}_{\ld\times \lc}]_1.
    \end{pmatrix}.$
\end{enumerate}

Steps 3, 4 can be done in constant-size with one of the QA-NIZK arguments we gave in Section \ref{Sect:QANIZKlinspace}. Step 2 can be done in constant-size with the results of \cite{AC:GonHevRaf15}. The total size of the proof is of size $2\lb|\GG_1|+\Theta(1)$, though, because 
of Step 1.\footnote{It would be tempting to try to construct a constant-size proof by replacing in Step 1 the GS commitments by a MP commitment to $\vecb{b}$ and Step 2 by a proof that the resulting commitment opens to a bit-string with the proof system $\mathcal{L}_{ck,\sfbits}.$ However, we do not know how to prove soundness in this case.}
