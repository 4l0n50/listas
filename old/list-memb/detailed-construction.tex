\begin{description}

\item[$\algK_0(1^\lambda)$:]  Return $\Gamma := (q,\GG_1,\GG_2,\GG_T,e,g,h) \leftarrow \ggen_a(1^{\lambda})$.

\item[$\dist_\Gamma$:] The distribution $\dist_\Gamma = \dist_\Gamma^1\times\dist_\Gamma^2$ over $\GG_2^{2\times 2}\times (2^{\GG_2} \times \N)$, where $\dist_\Gamma^1$ is some witness samplable distribution, defines the relation $\R_\Gamma = \{\R_{[\matr{V}]_2,L,n}\} \subseteq \GG_2^{2\times n}\times(\Z_q^{2\times n}\times\bits^{m\times n})$,
where $[\matr{V}]_2\gets\dist_\Gamma^1$ and $(L,n)\gets\dist_{\Gamma}^2$,
such that $([\Lcom]_2,\langle\matr{R}, \matr{B}\rangle)\in\R_{[\matr{V}]_2,L,n}$ iff
$\matr{1}_{1\times n}=\matr{1}_{1\times m}\matr{B}$ and $[\Lcom]_2=\GS.\Com_{[\matr{V}]_2}([\vecb{l}]_2\matr{B};\matr{R})$, where $[\vecb{l}]_2 := [l_1,\ldots,l_m]_2$. The relation $\R_{par}$ consists of pairs $([\matr{V}]_2,\matr{V})$ where $[\matr{V}]_2 \gets \dist_{\Gamma}^1$.

\item[{$\algK_1(\Gamma, ([\matr{V}]_2,L,n))$}:]
Pick $\vecb{g}_{n+1}\gets\Z_q^2$ and $\grkb{\mu}\gets\Z_q^{n}$, and define $\matr{G}_1:=\vecb{g}_{n+1}\grkb{\mu}^\top,\matr{G}:=(\matr{G}_1||\vecb{g}_{n+1})$. For each $j\in[n]$ denote by $\vecb{g}_j$ the $j$ th column of $\matr{G}$.
Let $\Psi_\sfbits$ the proof system described in Sect. \ref{sec:bits} and let $\crs_\sfbits\gets\Psi_\sfbits.\algK_1(\Gamma,[\matr{G}]_1)$.
Pick also $\crs_\GS\gets\GS.\algK_1(\Gamma)$ and define $[\matr{L}]_2:=\smallpmatrix{{[\vecb{l}]_2}\\{[\vecb{0}_{1\times m}]_2}}$.

The common reference string is given by $\mathsf{crs} := ([\matr{V}]_2,L,n,\crs_\sfbits,\crs_\GS)$

\item[{$\algP(\mathsf{crs}, [\Lcom]_2, \langle \matr{R},\matr{B}\rangle)$}:]
The proof $([\matr{C}]_1,\{\psi_\sfbits^i:i\in[m]\},\pi_\GS,[\grkb{\pi}]_2,[\matr{\Theta}]_1)$ is computed as follows:
\begin{enumerate}
\item $[\matr{C}]_1:=\MP.\Com_{[\matr{G}]_1}(\matr{B}^\top;\vecb{w}^\top),$ $\vecb{w}\gets\Z_q^m$.
\item For each $i\in[m]$, $\psi_\sfbits^i\gets\Psi_\sfbits.\algP(\crs_\sfbits,[\vecb{c}_i]_1,\langle \vecb{b}_i^\top, w_{i} \rangle)$.
\item $\pi_\GS\gets\GS.\algP(\crs_\GS,\sum_{i\in[m]}[\vecb{c}_i]_1-\sum_{j\in[n]}[\vecb{g}_j]_1=[\vecb{g}_{n+1}]_1\varz,\varz:=\sum_{i\in[m]}w_{i})$.

\item $[\grkb{\pi}]_2:=[\matr{V}]_2\vecb{r}_{n+1}-[\matr{L}]_2\vecb{w}$ and $[\matr{\Theta}]_1 := [\matr{G}]_1\pmatri{\matr{R}^\top\\-\vecb{r}_{n+1}^\top}$, $\vecb{r}_{n+1}\gets\Z_q^2$.
\end{enumerate}
\item[
{{$\algV(
    \crs,
    [\Lcom]_2,
    (
    [\matr{C}]_1,
    \{\psi_\sfbits^i:i\in[m]\},
    \phi,
    [\grkb{\pi}]_2,[\matr{\Theta}]_1
    ))$
}}:]
If any of the following checks fails, the verifier outputs $0$, else it outputs $1$.
\begin{enumerate}
\item For all $i\in[m]$, $\Psi_\sfbits.\algV(\crs_\sfbits, [\vecb{c}_i]_1,\psi_\sfbits^i)=1$. 
\item $\GS.\algV(\crs_\GS, \sum_{i\in[m]}[\vecb{c}_i]_1-\sum_{j\in[n]}[\vecb{g}_j]_1=[\vecb{g}_{n+1}]_1\varz, \pi_\GS)=1$.
\item $e([\matr{G}_1]_1,[\Lcom]_2^\top)/e([\matr{C}]_1,[\matr{L}]_2^\top) = e([\vecb{g}_{n+1}]_1,[\grkb{\pi}]_2^\top)\cdot e([\matr{\Theta}]_1,[\matr{V}]_2^\top)$.
\end{enumerate}

\item[{$\mathsf{S}_1(\Gamma,([\matr{V}]_2,L,n))$}:] 
%The simulator receives as input a description of an asymmetric bilinear group $\Gamma$ and the triplet $([\matr{V}]_2,L,n) \in \GG_2^{2 \times 2}\times2^{\GG_2}\times\N$ sampled according to distribution $\dist_{\Gamma}$.
The simulator generates and outputs the CRS in the same way as $\algK_1$, but additionally it also  outputs the simulation trapdoor $\tau=\left(\grkb{\mu}, \tau_\sfbits, \tau_\GS\right),$
where $\tau_\sfbits$ and $\tau_\Phi$ are $\Psi_\sfbits$'s and $\GS$'s simulation trapdoors, respectively, and
$\matr{G}_1=\vecb{g}_{n+1}\grkb{\mu}^\top$.
\item[{$\mathsf{S}_2(\crs,[\Lcom]_2,\tau)$}:] The the proof $([\matr{C}]_1,\{\psi_\sfbits^i:i\in[n]\},\phi,[\grkb{\pi}]_2,[\matr{\Theta}]_1)$ is simulated as follows:
\begin{enumerate}
\item $[\matr{C}]_1:=\MP.\Com(\matr{0}_{n\times m};\vecb{w}^\top)$, $\vecb{w}\gets \Z_q^n$.
\item For each $i\in[m]$, $\psi^i_\sfbits\gets\Psi_\sfbits.\algS_2(\crs_\sfbits,[\vecb{c}_i]_1,\tau_\sfbits)$.
\item $\pi_\GS\gets\GS.\algS_2(\crs_\GS,\sum_{i\in[m]}[\vecb{c}_i]_1-\sum_{j\in[n]}[\vecb{g}_j]_1=[\vecb{g}_{n+1}]_1\varz,\tau_\GS)$.
\item $[\grkb{\pi}]_2:=[\Lcom]_2\grkb{\mu}-[\matr{L}]_2\vecb{w}-[\matr{V}]_2\overline{\vecb{r}}$ and $[\matr{\Theta}]_1:=[\vecb{g}_{n+1}]_1\overline{\vecb{r}}^\top$, where $\overline{\vecb{r}}\gets\Z_q^2$.

\end{enumerate}
\end{description}

