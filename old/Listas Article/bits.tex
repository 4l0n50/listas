\begin{description}


\item[$\algK_1(\Gamma, \Lck,\Rck,\{\hmatr{W}_{i,j}\}_{(i,j) \in \indexSet{n}{1}})$]

Let $\QANIZKsum$ be the proof system for Sum in Subspace 
(Sect. \ref{sec:QANIZKsum}) and $\QANIZKcomms$
%=(\algK_0,\algK_1,\algP,\algV,\algS_1,\algS_2)$
be an instance of our proof system for Equal Opening (Sect. \ref{sec:aggcomms}).

Let
$\crs_\QANIZKsum \gets \algK_1(\Gamma, \{\hmatr{C}_{i,j},\cmatr{D}_{i,j}\}_{(i,j)\in\indexSet{n}{1}})$.\footnote{We identify
matrices in $\Gr^{2 \times 2}$ (resp. in $\Hr^{2 \times 2}$) with vectors in $\Gr^{4}$ (resp. in $\Hr^{4}$).} Generate $\crs_\QANIZKcomms \gets \algK_1(\Gamma, \Lck,\Rck,n)$. 

The common reference string is given by:
\begin{eqnarray*}
\mathsf{crs}_P&:=&\left(  \Lck,
    \check{\Lrck}, \{\matr{W}_{i,j} \}_{(i,j) \in \indexSet{n}{1}},\crs_\QANIZKsum,\crs_\QANIZKcomms \right).
 \end{eqnarray*}
\item[$\algP(\mathsf{crs}_P, \hvecb{c}, \langle \vecb{b}, w_g \rangle)$:]
Pick $w_h \gets \Z_q$,  $\matr{R} \gets \Z_q^{2\times 2}$ and then: 
\begin{enumerate}
\item Define 
$$\cvecb{d} := \Rck \begin{pmatrix} \vecb{b} \\ w_h \end{pmatrix}.$$ 
\item Compute 
 $(\hmatr{\Theta}, \cmatr{\Pi})\, := \sum_{i \in [n]}
 b_i w_h  \matr{W}_{i,n+1}+
 w_g(b_i-1) \matr{W}_{n+1,i}
 $
\begin{eqnarray} \label{eq:ThetaPi}
& &
    +
       \sum_{i \in [n]}  \sum_{\substack{j \in [n]\\ j\neq i}} b_i (b_j-1) \matr{W}_{i,j}  +
       w_gw_h \matr{W}_{n+1,n+1} +  (\hmatr{R},-\cmatr{R}).
 \end{eqnarray}Æ’

\item Compute a proof $(\hat{\boldsymbol \rho}_1,\check{\boldsymbol \sigma}_1)$
that $\matr{\Theta}+\cmatr{\Pi}$ is in the span of 
$\{\matr{C}_{i,j}+\matr{D}_{i,j}\}_{(i,j)\in\indexSet{n}{1}}$.
and a proof $(\hgrkb{\rho}_{2}, \cgrkb{\sigma}_{2})$
that
$(\hvecb{c},\cvecb{d})$ open to the same value,
using $\vecb{b},w_g$, and $w_h$. \\
\end{enumerate}

\item[$\algV(
    \mathsf{crs},
    \hvecb{c},
   \cvecb{d},
        (\hmatr{\Theta}, \cmatr{\Pi}), 
        \{(\hat{\boldsymbol \rho}_{i}, \check{\boldsymbol \sigma}_{i})\}_{i \in [2]} )$:] ~
%   
\begin{enumerate}
\item Check if 
\begin{equation}\label{eq:ver1}\hvecb{c}
\left(
    \check{\vecb{d}}-
    \sum_{j \in [n]} \rck_{j}
\right)^{\top} =
    \hmatr{\Theta} \cmatr{I}_{2 \times 2} +
    \hmatr{I}_{2 \times 2}\cmatr{\Pi}.
    \end{equation}  
  \item Verify that $(\hgrkb{\rho}_1, \cgrkb{\sigma}_1),(\hgrkb{\rho}_{2},\cgrkb{\sigma}_2)$ are valid proofs for %\linebreak 
  $(\hmatr{\Theta},$ $\cmatr{\Pi})$
        and $(\hvecb{c},\cvecb{d})$ using $\crs_\QANIZKsum$ and $\crs_\QANIZKcomms$ respectively.
\end{enumerate}
If any of these checks fails, the verifier outputs $0$, else it outputs $1$. \\

%The simulators $\algS_1$ and $\algS_2$ are defined as follows.
%\begin{description}
%\item[$\mathsf{S}_1(\Gamma,\hat{\matr{U}})$:] The simulator receives as input a description of an asymmetric bilinear group $\Gamma$ and a matrix $\hat{\matr{U}} \in \Gr^{(n+1) \times (n+1)}$ sampled according to distribution $\dist_{\Gamma}$. It generates and outputs the CRS in the same way as $\algK_1$, but additionally it also  outputs the simulation trapdoor 
%$$\tau=\left(\Lrck,\tau_\QANIZKsum, \tau_\QANIZKcomms\right),$$
%where $\tau_\QANIZKsum$ and $\tau_\QANIZKcomms$ are, respectively, $\QANIZKsum$'s and $\QANIZKcomms$'s simulation trapdoors.
\item[$\mathsf{S}_2(\crs,\vc,\left(\Lrck,\tau_\QANIZKsum, \tau_\QANIZKcomms\right))$:]  Given the matrix $\mat{H}$ of discrete logarithms of $\cmatr{H}$, $\tau_\QANIZKsum$ and $\tau_\QANIZKcomms$ which are, respectively, $\QANIZKsum$'s and $\QANIZKcomms$'s simulation trapdoors, this algorithm samples 
$\overline{w}_h \gets \Z_q$, $\matr{R} \gets \Z_q^{2 \times 2}$ and defines 
 $\vecb{d}:= \overline{w}_{h} \lrck_{n+1}.$
 Then it sets:
\begin{align*} 
\hmatr{\Theta} & :=  \hvecb{c}\left(\vecb{d}-\sum_{i \in [n]} \lrck_i\right)^\top + \hmatr{R},
    &
    \cmatr{\Pi} & := - \cmatr{R}.
%\\
%\hmatr{\Theta}_{b-\overline{b}} & :=  \hvecb{c}_\Delta \left( \sum_{i\in[n]}\lrck_{i}^\top \right) -
%                          \left( \sum_{i\in[n]}\hvecb{u}_{i} \right)\vecb{d}^\top + \hmatr{S},
%    &
%    \cmatr{\Pi}_{b-\overline{b}}& := - \cmatr{S}.
\end{align*}
Finally, it simulates proofs $(\hat{\boldsymbol \rho}_{X},
  \check{\boldsymbol \sigma}_{X})$
%for $(\hmatr{\Theta}_{X}, \cmatr{\Pi}_{X})$
for $X \in \{1,2\}$  using $\tau_\QANIZKsum$ and $\tau_\QANIZKcomms$.
\end{description}

\begin{theorem} Algorithms satisfy that...   
\begin{itemize}
 \item[a)] Completeness:
\item[b)] $1$-coordinate soundness: if there exists an index $i^*$ such that $\hvecb{g}_{i^*} \notin \mathsf{Span}(\{\hvecb{g}_{i} : i \neq i^*\})$ and $\hvecb{h}_{i^*} \notin \mathsf{Span}(\{\hvecb{h}_{i} : i \neq i^*\})$, then:
\begin{multline*}
\Pr\Big[ b_{i^*} \notin \{0,1\} \cap \Big(\exists (b_{i^*}, \vecb{w}): \ \hvecb{c}= b_{i^*} \hvecb{g}_{i^*} + \sum_{j \in [n+1], j\neq i^*} w_{j} \hvecb{g}_{j}  \Big)  \cap  \\ \algV(
\mathsf{crs},\vecb{c},\mathsf{proof})=1 | (\vecb{c},\mathsf{proof}) \gets \advA(\mathsf{crs})     \Big]=0$$
\end{multline*}
\item[c)] Perfect Zero-Knowledge: if xxxx 
\end{itemize}
\end{theorem}	
\begin{proof}
Completeness follows from XXX. Perfect Soundness follows from XXX. Perfect ZK follows from XXX.
\end{proof}
