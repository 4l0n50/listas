\section{Aggregated Proofs of Membership in a List} \label{sec:list-memb}

We wish to prove that $m$ GS commitments to group elements open to some value in a list (or an ordered set) $L:=\{\hat{l}_1,\ldots,\hat{l}_n\}$. We note that the values may not be necessarily distinct. 
More specifically, we wish to prove membership in the language
$$
\Lang_{\hmatr{U},L,m}:=\{[(\hat{c}_1,\ldots,\hat{c}_m)]_2 \forall i\in[m] \ \exists (\vecb{r}_i,\hat{x}_i) \in \Z_q^2 \times L \ \text{ s.t. } \hat{c}_i=\GScom(\hat{x}_i;\vecb{r}_i)\},
$$
where the witness for membership in the language are the pairs  $(\vecb{r}_i,\hat{x}_i)$. Below, we provide a proof whose communication is $\Theta(n)$, regardless of $m$. 

We note in particular that such a proof also works when $\hat{c}_i$ is an ElGamal ciphertext or the encryption scheme based on the $\lin{2}$ Assumption due to XXX --- which are special  cases of GS commitments where some randomness is set to $0$ --- for different instantiations of GS 


\subsection{Intuition}

\textbf{Observation}. If $(\hat{x}_1,\ldots, \hat{x}_m)$ is a vector of elements in a list $L$ if and only if there exists a matrix 
$\matrB=(b_{i,j})\in \{0,1\}^{m \times n}$, whose rows are denoted by 
$\vecb{b}_1,\ldots,\vecb{b}_m$, such that, 
 $[(x_1,\ldots, x_m)]_1= [(l_1,\ldots, l_m)]_2 \begin{pmatrix} b_{1,1} & \ldots & b_{1,n} \\
\vdots & & \vdots  
\\
b_{m,1} & \ldots & b_{m,n}
\end{pmatrix} = \sum_{i \in [n]} [l_i]_2 \vecb{b}_i $.  If we define 

\begin{example} If  $[(x_1,x_2,x_3, x_4)]_1=
[(l_1,l_3,l_2,l_1)]_1$, then 
$$[(x_1,x_2,x_3, x_4)]_1 = [(l_1,l_3,l_2,l_1)]_1\begin{pmatrix} 1 & 0 & 0 & 1\\
	0 & 0 & 1 & 0\\
	0 & 1 & 0 & 0
\end{pmatrix}= [l_1]_1 \begin{pmatrix} 1 & 0 & 0 & 1
\end{pmatrix} + [l_2]_1  \begin{pmatrix} 0 & 0 & 1 & 0
\end{pmatrix} + [l_3]_1 \begin{pmatrix} 0 & 1 & 0 & 0
\end{pmatrix}.$$

\end{example} 

\textbf{Trivial Approach}.  This suggests the following trivial approach. Problem. XX.


\begin{description}
	
	\item[$\algK_0(1^\lambda)$:]  Return $\Gamma := (q,\Gr,\Hr,\T,e,\hat{g},\check{h}) \leftarrow \ggen_a(1^{\lambda})$.
	
	%\item[$\dist_\Gamma$:] The distribution $\dist_\Gamma = \dist_\Gamma^1\times\dist_\Gamma^2$ over $\Gr^{2\times 2}\times (2^\Gr \times \N)$, where $\dist_\Gamma^1$ is some witness samplable distribution, defines the relation $\R_\Gamma = \{\R_{\hmatr{U},L,m}\} \subseteq \Gr^{2\times m}\times(\Z_q^{2\times m}\times\Gr^{1\times m})$,
	%where $\hmatr{U}\gets\dist_\Gamma^1$,
	%such that $((\hvecb{c}_1,\ldots,\hvecb{c}_m),\langle(\vecb{r}_1,\ldots,\vecb{r}_m), (\hat{x}_1,\ldots,\hat{x}_m)\rangle)\in\R_{\hmatr{U},L,m}$ iff
	%for all $i\in[m]$ $\hvecb{c}_i=\iota_1(\hat{x}_i)+\hmatr{U}\vecb{r}_i$ and $\hat{x}_i \in L$. The relation $\R_{par}$ %consists of pairs $(\hmatr{U},\matr{U})$ where $\hmatr{U} \gets \dist_{\Gamma}^1$.
	\item[$\algK_1(\Gamma, (\hmatr{U},L,m))$:]
	Let $\Psi_\sfbits$ the proof system described in XXX and let $\crs_\sfbits=(\Lck,\Rck,\crs'_\sfbits)\gets\Psi_\sfbits.\algK_1(\Gamma,m)$. For each $i\in[m+1]$ denote by $\rck_i$ the $i$ th column of $\Rck$.
	Let $\Phi$ the proof system for proving membership in linear subspaces of $\Gr^2$ and let $\crs_\Phi\gets\Phi.\algK_1(\Gamma,\rck_{m+1},2)$.
	
	The common reference string is given by $\mathsf{crs} := (\hmatr{U},L,m,\crs_\sfbits,\crs_\Phi)$
	
	\item[$\algP(\mathsf{crs}, \hmatr{C}, (\hmatr{R},\matr{B}))$:] Denote $\vecb{b}_{i}\in \bits^n$ as the ith row of 
	$\matr{B}$. \\
	\begin{enumerate}
		\item Let $\hgrkb{\beta}_i= \mathsf{Comm}_{\Gr,\hmatr{G}}^{\mathsf{MP}}(\vecb{b}_{i}; w_i)$, $w_i \gets \Z_q$.
		\item $\pi_{i,\mathsf{bits}} \gets \mathsf{Bits}.\mathsf{P}(\hgrkb{\beta}_i; w_i)$. 
		\item  Let $\hmatr{v}:=\sum_{i\in[m]}\hgrkb{\beta}_i-\sum_{j\in[n]}\lck_i$ and  $\pi_{\mathsf{LinSp}} \gets \gets \mathsf{LinSp}.\algP(\crs_{\mathsf{LinSp}},\hmatr{v},\sum_{i \in [n]} w_{i})$.
		
		\item Pick $\vecb{r}_{m+1}\gets\Z_q^2$ and compute $\cmatr{\Pi} := \sum_{i\in[m+1]}\vecb{r}_i\rck_i^\top$ and $\hgrkb{\theta}:=\sum_{j\in[n]}w_j\iota_1(\hat{l}_j)-\hmatr{U}\vecb{r}_{m+1}$.
	\end{enumerate}
	\item[
	$\algV(
	\crs,
	(\hvecb{c}_1,\ldots,\hvecb{c}_m),
	\langle
	\{
	(\hgrkb{\alpha}_j,\cgrkb{\beta}_j,\pi'_j):j\in [n\latexDeMierdaEstupido
	\},
	\check{\phi},
	\cmatr{\Pi},\hgrkb{\theta}
	\rangle)$
	]:
	\hfill\\
	%   
	\begin{enumerate}
		\item For all $j\in[n]$, check if $\Psi_\sfbits.\algV(\crs_\sfbits, (\hgrkb{\alpha}_j,\cgrkb{\beta}_j,\pi'_j))=1$. 
		\item Check if $\Phi.\algV(\crs_\Phi, \sum_{j\in[n]}\cgrkb{\beta}_j-\sum_{i\in[m]}\rck_i, \check{\phi})=1$.
		\item Check if $\sum_{i\in[m]}\hvecb{c}_i\rck_i^\top-\sum_{j\in[n]}\iota_1(\hat{l}_j)\cgrkb{\beta}_j^\top = \hmatr{U}\cmatr{\Pi}^\top+\hgrkb{\theta}\rck_{m+1}^\top$
	\end{enumerate}
	If any of these checks fails, the verifier outputs $0$, else it outputs $1$.
	
	\item[$\mathsf{S}_1(\Gamma,(\hat{\matr{U}},L,m))$:] The simulator receives as input a description of an asymmetric bilinear group $\Gamma$ and the triplet $(\hat{\matr{U}},L,m) \in \Gr^{2 \times 2}\times2^\Gr\times\N$ sampled according to distribution $\dist_{\Gamma}$. It generates and outputs the CRS in the same way as $\algK_1$, but additionally it also  outputs the simulation trapdoor 
	$$\tau=\left(\epsilon_1,\ldots,\epsilon_m, \tau_\QANIZKsum, \tau_\QANIZKcomms, \tau_\Phi\right),$$
	where $\tau_\QANIZKsum$, $\tau_\QANIZKcomms$, and $\tau_\Phi$ are $\QANIZKsum$'s, $\QANIZKcomms$'s, and $\Phi$'s simulation trapdoors, respectively, and
	$\rck_i=\epsilon_i\rck_{m+1}$ for each $i\in[m]$.
	\item[$\mathsf{S}_2(\crs,(\vc_1,\ldots,\vc_m),\tau)$:] 
	For each $j\in[n]$ compute $\pi_j\gets\Psi_\sfbits.\algP(\crs_\sfbits,\vecb{0}_{n\times1})$, that is, pick random $w_{g,j},w_{h,j} \gets \Z_q$  $\matr{R} \gets \Z_q^{2 \times 2}$ and define:
	\begin{align*}
		&\hgrkb{\alpha}_j := w_{g,j}\lck_{m+1}& &\cgrkb{\beta}_j := w_{h,j}\rck_{m+1}\\
		&\hmatr{\Theta}_{b(\overline{b}-1),j} :=  w_{g,j}w_{h,j}\hmatr{C}_{m+1,m+1}+\hmatr{R}& 
		&\cmatr{\Pi}_{b(\overline{b}-1),j} := w_{g,j}w_{h,j}\cmatr{D}_{m+1,m+1}- \cmatr{R}.
	\end{align*}
	Simulate proofs $(\hat{\boldsymbol \rho}_{X},
	\check{\boldsymbol \sigma}_{X})$,
	for $X \in \{b(\overline{b}-1),  b-\overline{b}\}$, and
	$\check{\phi}$  using $\tau_\QANIZKsum$, $\tau_\QANIZKcomms$, and $\tau_\Phi$.
	Finally, pick $\overline{\vecb{r}}\gets\Z_q^2$ and compute proofs
	\begin{align*}
		&\cmatr{\Pi}:=\overline{\vecb{r}}\rck_{m+1}^\top,& &\cgrkb{\theta}:=\sum_{i\in[m]}\epsilon_i\hvecb{c}_i-\sum_{j\in[n]}w_{h,j}\iota_1(\hat{l}_j)-\hmatr{U}\overline{\vecb{r}}.
	\end{align*}
\end{description}
