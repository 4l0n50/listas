In a NIZK Shuffle argument one wants to prove that two lists of ciphertexts open to the same values when second list is permuted under some hidden permutation.
If we represent each list of ciphertexts as a matrix where each column is an El-Gamal ciphertexts, then the language of correct shuffles under public key $[\vecb{v}]_2\in\GG^2_2$ can can be defined as 
$$
\Lang_{[\vecb{v}]_2,n,\mathsf{shuffle}}:=\{([\matr{C}]_2,[\matr{D}]_2)\in\GG_2^{2\times n}\times \GG_2^{2\times n} : \exists \matr{P}\in\mathcal{S}_n,\grkb{\delta}\in\Z_q^n \text{ s.t. } [\matr{C}]_2\matr{P}-[\matr{D}]_2 = [\vecb{v}]_2\grkb{\delta}^\top\}.$$
Where $\mathcal{S}_n$ is the set of permutation matrices of size $n\times n$. This definition can be generalized for any ``El-Gamal like'' encryption scheme as, for example, the BBS encryption scheme from \cite{C:BonBoySha04}.

The most efficient NIZK Shuffle argument under falsifiable assumptions is the one from Groth and Lu \cite{AC:GroLu07}, which works for BBS ciphertexts. The proof size is linear in the number of ciphertexts, specifically $15n + 120$ group elements in Type I groups. The security of their construction relies on two assumptions: the \emph{Paring Product Assumption} and the \emph{Permutation Pairing Assumption}. The first assumption is a $\dist_{2,n}\mbox{-}\kermdh$ Assumption, where $\matr{M}\gets\dist_{2,n}$ is of the form $\matr{M}:=\pmatri{x_1,\ldots,x_n\\x_1^2,\ldots,x_n^2}$ for $x_i\gets\Z_q$, $i\in[n]$. The second assumption is proven generically secure in \cite{AC:GroLu07} but it seems to be unrelated with any other assumption.

We construct a NIZK Shuffle argument with smaller proof size, specifically $4n+17$ elements of $\GG_1$, $14$ elements of $\GG_2$, and 1 element of $\Z_q$ in type III groups, and $6n+34$ group elements in Type I groups. The security is based on assumptions which are weaker than the \ddh~plus the \SSDP~Assumption in  Type III groups. In Type I groups our construction can be based on assumptions which are all weaker than \lin{2}.\footnote{In the symmetric case, the proof system from Sect. \ref{sec:bits} can be based on assumptions which are all weaker than $\lin{2}$, similarly as done in XXX Appendix XXX}
 
\subsection{Our construction}

Our proof system builds on a proof that a set of GS commitments opens to elements in the set $S=\{[s_1]_1,\ldots,[s_n]_1\}$, when the $\matr{S}=(s_1,\ldots,s_n)\gets\dist_{1,n}$ and the $\dist_{1,n}\mbox{-}\kermdh$ Assumption holds. Given $[\matr{F}]_1\gets\GS.\Com(\vvar{X})$, where $\vvar{X}=(\vvar{x}_1,\ldots,\vvar{x}_n):=[\matr{S}]_1\matr{P}^\top$, and $\vvar{y}:=[\matr{S}]_1\grkb{\delta}$, we prove that $([\matr{C}]_2,[\matr{D}]_2)\in\Lang_{[\vecb{v}]_2,n,\mathsf{shuffle}}$ as follows:
\begin{enumerate}[label=\alph*)]
\item Show that $[\matr{F}]_1\in\Lang_{S,\vecb{u}_1,\vecb{u}_2}^n$, where $\vecb{u}_1,\vecb{u}_2$ are GS commitment keys.\label{shuffle:a}
\item Give a GS proof for the satisfiability of $\sum_{i\in[n]}[s_i]_1-\sum_{j\in[n]}\vvar{x}_j=[0]_1$.\label{shuffle:b}
\item Give a GS proof for the satisfiability of
$
e(\vvar{X},[\matr{C}]_2^\top)/e([\matr{S}]_1,[\matr{D}]_2^\top)=e(\vvar{y},[\vecb{v}]^\top_2).\label{shuffle:c}
$
\end{enumerate}

A detailed description of our construction can be find in Fig. \ref{fig:shuffles}.

\subsubsection{Soundness Intuition.} Conditions \ref{shuffle:a} and \ref{shuffle:b} implies that the opening of $[\matr{F}]_1$ is a permutation of $[\matr{S}]$. That is, if $[\matr{X}]_1=[\matr{S}]_1\matr{B}$ is the opening of $[\matr{F}]_1$, then $\matr{B}\in\bits^{n\times n}$, $\matr{1}_{1\times n}\matr{B}=\matr{1}_{1\times n}$, and $\matr{B}\matr{1}_{n\times 1}=\matr{1}_{n\times 1}$. Condition \ref{shuffle:a} implies that $[\matr{X}]_1=[\matr{S}]_1\matr{B}$, where $\matr{B}\in\bits^{n\times n}$ and $\matr{1}_{1\times n}\matr{B}=\matr{1}_{1\times n}$. Condition \ref{shuffle:b} implies that $[\matr{S}]_1(\matr{1}_{n\times 1}-\matr{B}\matr{1}_{n\times 1})=[0]_1$, which in turn implies that $\matr{B}\matr{1}_{n\times 1}=\matr{1}_{n\times 1}$ unless $\matr{1}_{n\times 1}-\matr{B}\matr{1}_{n\times 1}$ is solution to the $\dist_{1,n}\mbox{-}\kermdh$ problem.

Suppose that $[\matr{C}]_2=\Enc_{[\vecb{v}]_2}([\matr{M}]_2)$ and $[\matr{C}]_2=\Enc_{[\vecb{v}]_2}([\matr{M}']_2)$. Let $\vecb{k}=(-v_2/v_1,1)^\top$ the ``decryption key'' (i.e. $\vecb{v}^\top\vecb{k}=0$ and $(0,1)\vecb{k}=1$)\footnote{The availability of the decryption key $\vecb{k}$ in the soundness reduction is possible since the reduction samples by itself the language parameter $\vecb{v}$. Correspondingly Groth and Lu \cite{AC:GroLu07} proved \emph{co-soundness}, which essentially requires the soundness adversary to produce the decryption key.}, we can point-wise exponentiate to $\matr{k}$ the equation from condition $\ref{shuffle:c}$ to ``decrypt'' $[\matr{C}]_2,[\matr{D}]_2$ and $[\vecb{v}]_2=\Enc_{[\vecb{v}]_2}([0]_2)$. We obtain that
$e([\matr{S}]_1\matr{B},[\matr{M}]_2)/e([\matr{S}]_1,[\matr{M'}]_2)=1_{\GG_T}$, which implies that $[\matr{M}]_2\matr{B}^\top=[\matr{M}']_2$ unless $[\matr{M}]_2\matr{B}^\top-[\matr{M}']_2$ is a solution to the $\dist_{1,n}\mbox{-}\kermdh$. Finally this implies that $[\matr{C}]_2\matr{B}^\top-[\matr{D}]_2$ is an encryption of $[\matr{0}_{n\times 1}]_2$ and thus $([\matr{C}]_2,[\matr{D}]_2)\in\Lang_{[\vecb{v}]_2,n,\mathsf{shuffle}}$. 

\input{shuffles/detailed-description}

