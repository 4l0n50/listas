\begin{figure} 
$$
\begin{array}{ll}
\begin{array}{l}
\algK_1(\Gamma,[\vecb{v}]_2,n)\quad (\mathsf{S}_1(\Gamma,[\vecb{v}]_2,n))\\
\hline
S:=\{[s_1]_1,\ldots,[s_n]_1\}, \matr{S}\gets\distlin_{1,n}\\
\crs_\GS\gets\GS.\algK_1(\Gamma)\\
{\crs_\sfbin\gets\Pi_\sfbin.\algK_1(\Gamma,[\matr{M}]_1,[\matr{N}]_1,[\matr{\Lambda}]_1,n)}\\
\text{Return } \ \crs:=([\vecb{v}]_2,\crs_\GS,\crs_\sfbin).\\
(\tau_\GS\gets\GS.\algS_1(\Gamma)\\
\tau_\sfbin\gets\Pi_\sfbin.\algS_1(\Gamma,L,[\matr{M}]_1,[\matr{N}]_1,[\matr{\Lambda}]_1,n).\\
\tau := (\matr{S},\tau_\GS,\tau_\sfbin)).\\
\\
\end{array}
&
\begin{array}{l}
{\algP(\crs, [\matr{C}]_2, [\matr{D}]_2,\langle \matr{P}, \grkb{\delta}\rangle)}\\
\hline
\vvar{X} := [\matr{S}]_1\matr{P}^\top,
\vvar{y} := [\matr{S}]_1\grkb{\delta}\\
\eq_1:= \sum_{i\in[n]}[s_i]_1-\sum_{j\in[n]}\vvar{x}_i = [0]_1\\
\eq_2:= {e(\vvar{X},[\matr{C}]_2^\top)}/{e([\matr{S}]_1,[\matr{D}]_2^\top)}=e(\vvar{y},[\vecb{v}]_2^\top)\\
\pi_\GS\gets\GS.\algP(\crs_\GS,\{\eq_1,\eq_2\},\vvar{X},\vvar{y})\\
\pi_\sfbin \gets \Pi_\sfbin.\algP(\crs_\sfbin, [\matr{F}]_1,\langle\matr{R},\matr{P}^\top\rangle)\\
//{[\matr{F}]_1} = \GS.\Com_{\crs_\GS}(\vvar{X};\matr{R})\\
\text{Return } \  (\pi_\GS,\pi_\sfbin). \\
\\
\end{array}\\
\begin{array}{l}
{\algV(\crs,[\matr{C}]_2,[\matr{D}]_2,(\pi_\GS,\pi_\sfbin))}\\
\hline
\eq_1:= \sum_{i\in[n]}[s_i]_1-\sum_{j\in[n]}\vvar{x}_i = [0]_1\\
\eq_2:= {e(\vvar{X},[\matr{C}]_2^\top)}/{e([\matr{S}]_1,[\matr{D}]_2^\top)}=e(\vvar{y},[\vecb{v}]_2^\top)\\
\mathsf{ans}_1 \gets \GS.\algV(\crs_\GS,\{\eq_1,\eq_2\},\pi_\GS)\\
\mathsf{ans}_2 \gets \Pi_\sfbin.\algV(\crs_\sfbin,[\matr{F}]_1,\pi_\sfbin)\\
\text{Return } \ \mathsf{ans}_1\wedge\mathsf{ans}_2.
\end{array}
&
\begin{array}{l}
{\mathsf{S}_2(\crs,[\matr{C}]_1,[\matr{D}]_1,\tau)}\\
\hline
\eq_1:= \sum_{i\in[n]}[s_i]_1-\sum_{j\in[n]}\vvar{x}_i = [0]_1\\
\eq'_2:= {e(\vvar{X},[\matr{C}]_2^\top)}/{e([1]_1,\matr{S}^\top[\matr{D}]_2^\top)}=e(\vvar{y},[\vecb{v}]_2^\top)\\
\pi_\GS\gets \GS.\algS_2(\crs_\GS,\{\eq_1,\eq'_2\},\tau_\GS)\\
\pi_\sfbin\gets \Pi_\sfbin.\algS_2(\crs_\sfbin,[\matr{F}]_1,\tau_\sfbin)\\
\text{Return }  (\pi_\GS,\pi_\sfbin).
\end{array}
\end{array}$$
\caption{The proof system $\Pi_\mathsf{shuffle}$ for the language $\Lang_{[\vecb{v}]_2,n,\mathsf{shuffle}}$. The matrices $\matr{M},\matr{N},\matr{\Lambda}$ are defined as $\matr{M}:=\usebox{\smat},\matr{N}:=(\vecb{u}_1||\vecb{u}_2),\matr{\Lambda}:= (1,\ldots,1)$, where $\vecb{u}_1,\vecb{u}_2$ are the GS commitment keys from $\crs_\GS$. The proof size is $|\pi_\GS|+|\pi_\sfbin|=(2n+6)|\GG_1|+4|\GG_2|+1|\Z_q|+(2n+11)|\GG_1|+10|\GG_2|=(4n+17)|\GG_1|+14|\GG_2|+1|\Z_q|$.
\label{fig:shuffles}}
\end{figure}

