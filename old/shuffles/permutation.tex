We motivate our construction with the following fact about permutation matrices

\begin{fact} The matrix $\matr{P}\in\Z_q^{n\times n}$ is a permutation matrix if and only if
\begin{enumerate}
    \item $\matr{P}\in\bits^{n\times n}$.
    \item $\matr{1}_{1\times n}\matr{P}=\matr{1}_{1\times n}$.
    \item $\matr{P}\matr{1}_{n\times 1}= \matr{1}_{n\times 1}$.
\end{enumerate}
\end{fact}

This fact motivates the following trivial solution. Compute coordinate-wise GS commitment to $\matr{P}$, satisfiability of equations implied by 1,2 and 3, imply that $\matr{P}$ is permutation matrix. However, only commitments to $\matr{P}$ requires $\Theta(n^2)$ group elements. Below we describe an alternative way to commit to $\matr{P}$ using only $\Theta(n)$ group elements.

Given GS commitment key $[\matr{V}]_2\in\GG_2^{2\times 2}$ and some list $L$ of size $n$ to be defined later, the proof system from Sect. \ref{sec:list-memb} allows to prove that a matrix $[\Lcom]_2\in\GG_2^{2\times n}\in\Lang_{[\matr{V}]_2,L,n}$. That is, there exists sombre matrix $\matr{R}\in\Z_q^{2\times n},\matr{B}\in\bits^{n\times n}$ (i.e. $m:=n$) such that $\matr{1}_{1\times n}\matr{B}=\matr{1}_{1\times n}$ and $[\Lcom]_2 = [\matr{L}]_2\matr{B}+[\matr{V}]_2\matr{R}$. If we think of $[\Lcom]_2$ as a commitment to $\matr{P}:=\matr{B}$, the proof system from Sect. \ref{sec:list-memb} allows to prove statements 1 and 2. The natural way to prove statement 3 should be
to prove that $
[\Lcom]_2\matr{1}_{n\times 1}-[\matr{L}]_2\matr{1}_{n\times 1} = [\matr{V}]_2\grkb{\gamma}
$, for some $\grkb{\gamma}\in\Z_q^2$, which implies that $[\matr{L}]_2(\matr{P}\matr{1}_{n\times 1}-\matr{1}_{n\times 1})=0$. If we define $L:=\{[a_1]_2,\ldots,[a_n]_2\}$, where $\vecb{a}\gets \dist_{n,1}$ and the $\dist_{n,1}\mbox{-}\kermdh$ problem is hard, then $\matr{P}\matr{1}_{n\times 1}=\matr{1}_{n\times 1}$, unless one can find a solution to the $\dist_{n,1}\mbox{-}\kermdh$ Assumption We conclude that $\matr{P}$ is a permutation matrix.

Now, given $([\matr{C}]_1,[\matr{D}]_1)\in\GG^{2\times n}\times\GG_1^{2\times n}$ and $[\Lcom]_2$, which defines a GS commitment to $\varvecx:=[\vecb{a}]_2\matr{P}^\top$, we show with a GS proof the satisfiability of
\begin{equation}
\dfrac{e([\matr{C}]_1,\varvecx^\top)}{e([\matr{D}]_1,[\vecb{a}]_2^\top)}
=
e([\vecb{u}]_1,\mathsf{y}),
\label{eq:shuffle}
\end{equation}
fro some $\mathsf{y}\in\GG_2$.

We briefly comment why this imply soundness. Given $\vecb{u}$, one can compute $\vecb{k}\in\Z_q^2$ such that $\vecb{k}^\top[\matr{C}]_1=[\vecb{m}]_1\in\GG_1^{1\times n}$, and $\vecb{k}^\top[\matr{D}]_1=[\vecb{m}']_1\in\GG_1^{1\times n}$, the decryptions of $[\matr{C}]_1$ and $[\matr{D}]_1$, and $\vecb{k}^\top[\vecb{u}]_1=[\vecb{0}]_1$.\footnote{In the Quasi-Adaptive setting, we prove membership in the CRS dependent language $\Lang_{\hvecb{u},n,\mathsf{shuffle}}$. This allows us to decrypt the ciphertexts in the soundness game, using the discrete logarithm of $\hvecb{u}$. Similarly, Groth and Lu proved \emph{co-soundness}, which requires the adversary to provide the decryption key.} If we multipliy Eq. \ref{eq:shuffle} by $\vecb{k}^\top$ on the right we get
$$
e([\vecb{m}]_1\matr{P}^\top-[\vecb{m}']_1,[\vecb{a}]_2^\top)=1,
$$
which implies that $([\matr{C}]_1,[\matr{D}]_1)\in\Lang_{[\vecb{u}]_1,n,\mathsf{shuffle}}$, unless $[\vecb{m}]_1\matr{P}^\top-[\vecb{m}']_1$ is a solution to the $\dist_{n,1}\mbox{-}\kermdh$ Assumption.

\input{shuffles/detailed-description}

Figure \ref{fig:shuffles} provides detailed description of the proof system for $\Lang_{[\vecb{u}]_1,n,\mathsf{shuffle}}$.

